<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../../css/main.css" />
  <script src="../../js/api/cliente/cliente.js"></script>
  <link rel="shortcut icon" href="../../assets/svg/logo_rosa.svg" type="image/x-icon" />
  <title>Salon Time | Login </title>
</head>

<body>
  <div class="login">

    <div class="login__imagem">
      <img src="../../assets/img/logincadastro.png" class="login__img" alt="">
    </div>


    <div class="login__form">
      <button href="index.html" class="login__voltar">← Voltar</button>

      <div class="login__title">
        <h1 class="titulo-1">Bem vinda(o) de volta!</h1>
      </div>
      <div class="login__formulario">
        <div class="input_pai">
          <label for="email">Endereço de e-mail</label>
          <input type="email" id="email" class="input" placeholder="Placeholder">
        </div>


        <div class="input_pai">
          <label for="senha">Senha</label>
          <input type="password" id="senha" class="input" placeholder="Placeholder">
        </div>

        <button type="submit" onclick="login()" class="btn-rosa login__btn">Cadastrar</button>

        <div class="linha-horizontal"></div>

      </div class="login__formulario">


      <div>
        <p class="paragrafo-2">Não tem uma conta?
          <button href="cadastro.html" class="login__entrar">Cadastre-se</button>
        </p>
      </div>

    </div>
  </div>
  </div>
</body>

</html>
<script>

  function logar() {
    event.preventDefault();

    let emailUsuario = document.getElementById("email_usuario").value;
    let senhaUsuario = document.getElementById("senha_usuario").value;

    if (emailUsuario === "" || senhaUsuario === "") {
      Swal.fire({
        icon: "error",
        title: "Oops...",
        text: "Por favor, preencha todos os campos!",
        color: '#fff',
        background: '#1d1d1d',
        confirmButtonColor: '#4E2E9E',
      });
      return;
    }

    fetch("/usuarios/autenticar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        emailServer: emailUsuario,
        senhaServer: senhaUsuario,
      }),
    })
      .then(function (resposta) {
        console.log("Resposta: ", resposta);

        if (resposta.ok) {
          resposta.json().then((resposta) => {
            if (resposta.isAtivo !== 1) {
              Swal.fire({
                icon: "error",
                title: "Usuário Inativo!",
                text: "Se você acredita que foi um erro, contate o administrador da sua organização.",
                color: '#fff',
                confirmButtonColor: '#4E2E9E',
                background: '#1d1d1d',
              }).then(() => {
                window.location.reload();
              });
            } else {

              sessionStorage.setItem("ID_USUARIO", resposta.idUsuario);
              sessionStorage.setItem("NOME_USUARIO", resposta.nome);
              sessionStorage.setItem("EMAIL_USUARIO", resposta.email);
              sessionStorage.setItem("ID_EMPRESA_USUARIO", resposta.fkEmpresa);
              sessionStorage.setItem("IS_ADM_USUARIO", resposta.isAdm);
              sessionStorage.setItem("IS_ATIVO_USUARIO", resposta.isAtivo);
              sessionStorage.setItem("NOME_EMPRESA", resposta.nomeEmpresa);

              Swal.fire({
                icon: "success",
                title: "Login Realizado com sucesso!",
                showConfirmButton: false,
                timer: 1500,
                color: '#fff',
                background: '#1d1d1d',
              }).then(() => {
                if (resposta.isAdm === 1) {
                  window.location.href = "./dashboard/dashboard-adm.html";
                } else if (resposta.isAdm === 0) {
                  window.location.href = "./dashboard/dashboard-analista.html";
                } else {
                  Swal.fire({
                    icon: "error",
                    title: "Falha ao redirecionar para a dashboard!",
                    showConfirmButton: false,
                    timer: 1500,
                    color: '#fff',
                    background: '#1d1d1d',
                  }).then(() => {
                    window.location.reload();
                  })
                }
              });
            }
          });

        } else {
          throw "Houve um erro ao tentar realizar o login!";
        }
      })
      .catch(function (erro) {
        console.log(`#ERRO: ${erro}`);
        Swal.fire({
          icon: "error",
          title: "Oops...",
          text: "Usuário não encontrado!",
          color: '#fff',
          background: '#1d1d1d',
          confirmButtonColor: '#4E2E9E',
        });
      });
  }
</script>